<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="å’Œå¾€å¸¸ä¸€æ ·ï¼Œç³»ç»Ÿä¸º debianï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ 1. Nginx å®‰è£…å’Œé…ç½® Nginxå®˜ç½‘æ–‡æ¡£ https://nginx.org/en/docs/ Nginxï¼ˆå‘éŸ³ä¸º&quot;engine-x&quot;ï¼‰">
<title>Nginxä½¿ç”¨ï¼Œé…ç½®ï¼Œæ¨¡æ¿ä¸€é”®ç”Ÿæˆï¼ŒCertbotå®‰è£…å’Œç”³è¯·å…è´¹Let&#39;s Encryptè¯ä¹¦</title>

<link rel='canonical' href='https://hublog.netlify.app/p/2403006/'>

<link rel="stylesheet" href="/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css"><meta property='og:title' content="Nginxä½¿ç”¨ï¼Œé…ç½®ï¼Œæ¨¡æ¿ä¸€é”®ç”Ÿæˆï¼ŒCertbotå®‰è£…å’Œç”³è¯·å…è´¹Let's Encryptè¯ä¹¦">
<meta property='og:description' content="å’Œå¾€å¸¸ä¸€æ ·ï¼Œç³»ç»Ÿä¸º debianï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ 1. Nginx å®‰è£…å’Œé…ç½® Nginxå®˜ç½‘æ–‡æ¡£ https://nginx.org/en/docs/ Nginxï¼ˆå‘éŸ³ä¸º&quot;engine-x&quot;ï¼‰">
<meta property='og:url' content='https://hublog.netlify.app/p/2403006/'>
<meta property='og:site_name' content='Seektao | å¯»é“ä¹‹æ—…'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='nginx' /><meta property='article:tag' content='ssl' /><meta property='article:tag' content='certbot' /><meta property='article:published_time' content='2024-03-06T00:03:15&#43;08:00'/><meta property='article:modified_time' content='2024-03-06T00:03:15&#43;08:00'/>
<meta name="twitter:title" content="Nginxä½¿ç”¨ï¼Œé…ç½®ï¼Œæ¨¡æ¿ä¸€é”®ç”Ÿæˆï¼ŒCertbotå®‰è£…å’Œç”³è¯·å…è´¹Let's Encryptè¯ä¹¦">
<meta name="twitter:description" content="å’Œå¾€å¸¸ä¸€æ ·ï¼Œç³»ç»Ÿä¸º debianï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚ 1. Nginx å®‰è£…å’Œé…ç½® Nginxå®˜ç½‘æ–‡æ¡£ https://nginx.org/en/docs/ Nginxï¼ˆå‘éŸ³ä¸º&quot;engine-x&quot;ï¼‰">
  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hua656ab6dfe1fc382193f550011041410_6344_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Seektao | å¯»é“ä¹‹æ—…</a></h1>
            <h2 class="site-description">æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸»é¡µ</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/muyiacc'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>æœç´¢</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>å½’æ¡£</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>é“¾æ¥</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#11-å®‰è£…">1.1 å®‰è£…</a></li>
    <li><a href="#12-é…ç½®æ–‡ä»¶">1.2 é…ç½®æ–‡ä»¶</a></li>
    <li><a href="#13--é…ç½®ä»¶çš„ç»“æ„">1.3  é…ç½®â½‚ä»¶çš„ç»“æ„</a>
      <ol>
        <li><a href="#131-å…¨å±€å—">1.3.1 å…¨å±€å—</a></li>
        <li><a href="#132-eventså—">1.3.2 eventså—</a></li>
        <li><a href="#133-httpå—">1.3.3 httpå—</a></li>
        <li><a href="#134-serverå—">1.3.4 serverå—</a></li>
      </ol>
    </li>
    <li><a href="#14-nginxå¸¸ç”¨å‘½ä»¤">1.4 Nginxå¸¸ç”¨å‘½ä»¤</a></li>
  </ol>

  <ol>
    <li><a href="#21-å®‰è£…-certbot">2.1 å®‰è£… certbot</a></li>
    <li><a href="#22-ç”³è¯·åŸŸåè¯ä¹¦">2.2 ç”³è¯·åŸŸåè¯ä¹¦</a></li>
    <li><a href="#23-dnsè·å–sslæ³›åŸŸåè¯ä¹¦æ¨è">2.3 DNSè·å–SSLæ³›åŸŸåè¯ä¹¦ï¼ˆæ¨èï¼‰</a>
      <ol>
        <li><a href="#231-certbot-dns-dnspod">2.3.1 certbot-dns-dnspod</a></li>
      </ol>
    </li>
    <li><a href="#24-è‡ªåŠ¨ç»­æœŸ">2.4 è‡ªåŠ¨ç»­æœŸ</a></li>
  </ol>

  <ol>
    <li><a href="#31-éœ€æ±‚1">3.1 éœ€æ±‚1</a>
      <ol>
        <li><a href="#311--è„šæœ¬çš„é…ç½®">3.1.1  è„šæœ¬çš„é…ç½®</a></li>
      </ol>
    </li>
    <li><a href="#32-éœ€æ±‚2">3.2 éœ€æ±‚2</a>
      <ol>
        <li><a href="#321--è„šæœ¬çš„é…ç½®">3.2.1  è„šæœ¬çš„é…ç½®</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/default/" >
                Default
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/2403006/">Nginxä½¿ç”¨ï¼Œé…ç½®ï¼Œæ¨¡æ¿ä¸€é”®ç”Ÿæˆï¼ŒCertbotå®‰è£…å’Œç”³è¯·å…è´¹Let&#39;s Encryptè¯ä¹¦</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 06, 2024</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œç³»ç»Ÿä¸º debianï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ã€‚</p>
<h1 id="1-nginx-å®‰è£…å’Œé…ç½®">1. Nginx å®‰è£…å’Œé…ç½®
</h1><blockquote>
<p>Nginxå®˜ç½‘æ–‡æ¡£
<a class="link" href="https://nginx.org/en/docs/"  target="_blank" rel="noopener"
    >https://nginx.org/en/docs/</a></p>
</blockquote>
<p><strong>Nginx</strong>ï¼ˆå‘éŸ³ä¸º&quot;engine-x&quot;ï¼‰æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å¼€æº Web æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œåå‘ä»£ç†æœåŠ¡å™¨ã€è´Ÿè½½å‡è¡¡å™¨å’Œ HTTP ç¼“å­˜ã€‚</p>
<h2 id="11-å®‰è£…">1.1 å®‰è£…
</h2><p>ï¼ˆ1ï¼‰å®‰è£…Nginx</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># debian</span>
</span></span><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl">sudo apt install nginx
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># centos</span>
</span></span><span class="line"><span class="cl">sudo yum update
</span></span><span class="line"><span class="cl">sudo yum install nginx
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å…³äºNginxçš„ä¸€äº›å‘½ä»¤å’Œé…ç½®æ–‡ä»¶çš„ä½ç½®ä»‹ç»</p>
<p>åœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ° é…ç½®æ–‡ä»¶çš„ä½ç½®åœ¨ <code>/etc/nginx</code>ä¸‹
å½“ç„¶ä¸åŒçš„å®‰è£…æ–¹å¼ä¹Ÿå¯èƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ <code>whereis nginx</code>æ¥æœç´¢</p>
</blockquote>
<h2 id="12-é…ç½®æ–‡ä»¶">1.2 é…ç½®æ–‡ä»¶
</h2><p>é€šè¿‡åŒ…ç®¡ç†å·¥å…·å®‰è£…çš„Nginxä¸€èˆ¬åœ¨ <code>/etc/nginx</code>ä¸‹</p>
<p>å…¶ä¸­æœ‰ä¸€ä¸ª <code>nginx.conf</code> æ–‡ä»¶ï¼Œå®ƒå°±æ˜¯Nginxçš„é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæ‰€ä»¥æˆ‘ä¸€èˆ¬ä¸ç›´æ¥ä¿®æ”¹è¯¥æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨ <code>/etc/nginx/conf.d/</code> ä¸‹æ–°å»ºæ–‡ä»¶ã€‚</p>
<p>åœ¨é»˜è®¤çš„ <code>nginx.conf</code>ä¸­ <code>http</code>æ¨¡å—ä¸‹ï¼Œæœ‰è¿™æ ·ä¸€æ¡å‘½ä»¤ <code>include /etc/nginx/conf.d/*.conf;</code> å®ƒè¡¨ç¤ºåŒ…å«äº† <code>/etc/nginx/conf.d/</code>ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨<code>/etc/nginx/conf.d/</code>ç›´æ¥æ·»åŠ æ–°æ–‡ä»¶å³å¯ï¼Œå¦‚æœæ²¡æœ‰è¯¥å‘½ä»¤éœ€è¦æ‰‹åŠ¨æŠŠæ–‡ä»¶çš„è·¯å¾„æ·»åŠ åˆ° <code>nginx.conf</code>ä¸­</p>
<p>å…³äº Nginxé…ç½®æ–‡ä»¶æ¨¡å—è¯¥å¦‚ä½•ä¹¦å†™ï¼Œä»¥ä¸‹åšä¸€äº›ç®€å•ä»‹ç»ã€‚</p>
<h2 id="13--é…ç½®ä»¶çš„ç»“æ„">1.3  é…ç½®â½‚ä»¶çš„ç»“æ„
</h2><p>Nginxçš„é…ç½®â½‚ä»¶æ˜¯ç”±â¼€ç³»åˆ—çš„æŒ‡ä»¤ç»„æˆçš„ï¼Œæ¯ä¸ªæŒ‡ä»¤éƒ½æ˜¯ç”±â¼€ä¸ªæŒ‡ä»¤åå’Œâ¼€ä¸ªæˆ–è€…å¤šä¸ªå‚æ•°ç»„æˆçš„ã€‚</p>
<p>æŒ‡ä»¤å’Œå‚æ•°ä¹‹é—´ä½¿â½¤ç©ºæ ¼æ¥åˆ†éš”ï¼ŒæŒ‡ä»¤ä»¥åˆ†å· ; ç»“å°¾ï¼Œå‚æ•°å¯ä»¥ä½¿â½¤å•å¼•å·æˆ–è€…åŒå¼•å·æ¥åŒ…è£¹ã€‚</p>
<p>é…ç½®â½‚ä»¶åˆ†ä¸ºä»¥ä¸‹â¼ä¸ªéƒ¨åˆ†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å…¨å±€å—</span>
</span></span><span class="line"><span class="cl">worker_processes 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">events <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># eventså—</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">http <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># httpå—</span>
</span></span><span class="line"><span class="cl">	server <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># serverå—</span>
</span></span><span class="line"><span class="cl">		location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1"># locationå—</span>
</span></span><span class="line"><span class="cl">		<span class="o">}</span>
</span></span><span class="line"><span class="cl">	<span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">server {  
</span></span><span class="line"><span class="cl">    listen 80;  
</span></span><span class="line"><span class="cl">    server_name seektao.cc;
</span></span><span class="line"><span class="cl">    return 301 https://www.seektao.cc$request_uri;  
</span></span><span class="line"><span class="cl">}  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">server {  
</span></span><span class="line"><span class="cl">    listen 80;  
</span></span><span class="line"><span class="cl">    server_name www.seektao.cc;  
</span></span><span class="line"><span class="cl">    return 301 https://$host$request_uri;  
</span></span><span class="line"><span class="cl">}  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server {  
</span></span><span class="line"><span class="cl">    listen 443 ssl http2;  
</span></span><span class="line"><span class="cl">    server_name www.seektao.cc;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªNginxé…ç½®æ–‡ä»¶åŒ…å«äº†ä¸‰ä¸ªserverå—ï¼Œæ¯ä¸ªå—å®šä¹‰äº†ä¸åŒçš„è™šæ‹Ÿä¸»æœºé…ç½®ã€‚</p>
<ol>
<li>ç¬¬ä¸€ä¸ªserverå—ï¼š
<ul>
<li><code>listen 80;</code>: ç›‘å¬80ç«¯å£ï¼Œè¡¨ç¤ºè¿™ä¸ªserverå—ç”¨äºå¤„ç†HTTPè¯·æ±‚ã€‚</li>
<li><code>server_name seektao.cc;</code>: æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåä¸º<code>seektao.cc</code>ã€‚</li>
<li><code>return 301 https://www.seektao.cc$request_uri;</code>: å½“æœ‰HTTPè¯·æ±‚è®¿é—®<code>seektao.cc</code>æ—¶ï¼Œè¿”å›301é‡å®šå‘åˆ°<code>https://www.seektao.cc$request_uri</code>ï¼Œå³å°†HTTPè¯·æ±‚é‡å®šå‘åˆ°HTTPSåè®®çš„<code>www.seektao.cc</code>ã€‚</li>
</ul>
</li>
<li>ç¬¬äºŒä¸ªserverå—ï¼š
<ul>
<li><code>listen 80;</code>: åŒæ ·ç›‘å¬80ç«¯å£ï¼Œå¤„ç†HTTPè¯·æ±‚ã€‚</li>
<li><code>server_name www.seektao.cc;</code>: æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåä¸º<code>www.seektao.cc</code>ã€‚</li>
<li><code>return 301 https://$host$request_uri;</code>: å½“æœ‰HTTPè¯·æ±‚è®¿é—®<code>www.seektao.cc</code>æ—¶ï¼Œè¿”å›301é‡å®šå‘åˆ°<code>https://$host$request_uri</code>ï¼Œå³å°†HTTPè¯·æ±‚é‡å®šå‘åˆ°HTTPSåè®®çš„<code>www.seektao.cc</code>ã€‚</li>
</ul>
</li>
<li>ç¬¬ä¸‰ä¸ªserverå—ï¼š
<ul>
<li><code>listen 443 ssl http2;</code>: ç›‘å¬443ç«¯å£ï¼Œå¯ç”¨SSLå’ŒHTTP/2åè®®ã€‚</li>
<li><code>server_name www.seektao.cc;</code>: æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåä¸º<code>www.seektao.cc</code>ã€‚</li>
</ul>
</li>
</ol>
<p>è¿™ä¸ªé…ç½®æ–‡ä»¶çš„ä½œç”¨æ˜¯ï¼š</p>
<ul>
<li>å½“æœ‰HTTPè¯·æ±‚è®¿é—®<code>seektao.cc</code>æˆ–<code>www.seektao.cc</code>æ—¶ï¼Œä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°ç›¸åº”çš„HTTPSåœ°å€ã€‚</li>
<li>å¯¹äºHTTPSè¯·æ±‚ï¼Œåªæœ‰<code>www.seektao.cc</code>ä¼šè¢«å¤„ç†ï¼Œè€Œå…¶ä»–åŸŸåæˆ–è·¯å¾„åˆ™æ²¡æœ‰é…ç½®å¤„ç†è§„åˆ™ï¼Œå¯èƒ½ä¼šè¿”å›é»˜è®¤çš„Nginxé¡µé¢æˆ–404é”™è¯¯ã€‚</li>
</ul>
<p>è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„é…ç½®ç¤ºä¾‹ï¼Œå®é™…ç”Ÿäº§ç¯å¢ƒä¸­è¿˜éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè¿›ä¸€æ­¥é…ç½®ï¼Œä¾‹å¦‚é…ç½®SSLè¯ä¹¦ã€ä»£ç†ã€ç¼“å­˜ç­‰åŠŸèƒ½ã€‚</p>
<h3 id="131-å…¨å±€å—">1.3.1 å…¨å±€å—
</h3><p>å…¨å±€å—æ˜¯é…ç½®â½‚ä»¶çš„ç¬¬â¼€ä¸ªå—ï¼Œä¹Ÿæ˜¯é…ç½®â½‚ä»¶çš„ä¸»ä½“éƒ¨åˆ†ï¼Œä¸»è¦â½¤æ¥è®¾ç½®â¼€äº›å½±å“NginxæœåŠ¡å™¨æ•´ä½“è¿â¾çš„é…ç½®æŒ‡ä»¤ï¼Œä¸»è¦åŒ…æ‹¬é…ç½®è¿â¾NginxæœåŠ¡å™¨çš„â½¤æˆ·ï¼ˆç»„ï¼‰ã€å…è®¸â½£æˆçš„workerprocessæ•°ã€è¿›ç¨‹PIDå­˜æ”¾è·¯å¾„ã€â½‡å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹ä»¥åŠé…ç½®â½‚ä»¶å¼•â¼Šç­‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šè¿â¾NginxæœåŠ¡å™¨çš„â½¤æˆ·ï¼Œåªèƒ½åœ¨å…¨å±€å—é…ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1"># å°†useræŒ‡ä»¤æ³¨é‡Šæ‰ï¼Œæˆ–è€…é…ç½®æˆnobodyçš„è¯æ‰€æœ‰â½¤æˆ·éƒ½å¯ä»¥è¿â¾</span>
</span></span><span class="line"><span class="cl"><span class="c1"># user [user] [group]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># user nobody nobody;</span>
</span></span><span class="line"><span class="cl">user nginx<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŒ‡å®šâ½£æˆçš„workerè¿›ç¨‹çš„æ•°é‡ï¼Œä¹Ÿå¯ä½¿â½¤â¾ƒåŠ¨æ¨¡å¼ï¼Œåªèƒ½åœ¨å…¨å±€å—é…ç½®</span>
</span></span><span class="line"><span class="cl">worker_processes 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># é”™è¯¯â½‡å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹</span>
</span></span><span class="line"><span class="cl">error_log /var/log/nginx/error.log warn<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è¿›ç¨‹PIDå­˜æ”¾è·¯å¾„</span>
</span></span><span class="line"><span class="cl">pid /var/run/nginx.pid<span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="132-eventså—">1.3.2 eventså—
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">events <span class="o">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># æŒ‡å®šä½¿â½¤å“ªç§â½¹ç»œIOæ¨¡å‹ï¼Œåªèƒ½åœ¨eventså—ä¸­è¿›â¾é…ç½®</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># use epoll</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># æ¯ä¸ªworker processå…è®¸çš„æœ€â¼¤è¿æ¥æ•°</span>
</span></span><span class="line"><span class="cl">	worker_connections 1024<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="133-httpå—">1.3.3 httpå—
</h3><p>httpå—æ˜¯é…ç½®â½‚ä»¶çš„ä¸»è¦éƒ¨åˆ†ï¼ŒåŒ…æ‹¬httpå…¨å±€å—å’Œserverå—ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">http <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># nginx å¯ä»¥ä½¿ç”¨includeæŒ‡ä»¤å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">    include /etc/nginx/mime.types<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># é»˜è®¤ç±»å‹ï¼Œå¦‚æœè¯·æ±‚çš„URLæ²¡æœ‰åŒ…å«æ–‡ä»¶ç±»å‹ï¼Œä¼šä½¿ç”¨é»˜è®¤ç±»å‹</span>
</span></span><span class="line"><span class="cl">    default_type application/octet-stream<span class="p">;</span> <span class="c1"># é»˜è®¤ç±»å‹</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼</span>
</span></span><span class="line"><span class="cl">    sendfile on<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
</span></span><span class="line"><span class="cl">    keepalive_timeout 65<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># access_log æ—¥å¿—å­˜æ”¾è·¯å¾„å’Œç±»å‹</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># æ ¼å¼ä¸ºï¼šaccess_log &lt;path&gt; [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]];</span>
</span></span><span class="line"><span class="cl">    access_log /var/log/nginx/access.log main<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># å®šä¹‰æ—¥å¿—æ ¼å¼</span>
</span></span><span class="line"><span class="cl">    log_format main <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; $status $body_bytes_sent &#34;$http_referer&#34; &#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># è®¾ç½®sendfileæœ€å¤§ä¼ è¾“ç‰‡æ®µå¤§å°ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># sendfile_max_chunk 1m;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># æ¯ä¸ªè¿æ¥çš„è¯·æ±‚æ¬¡æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># keepalive_requests 100;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># keepaliveè¶…æ—¶æ—¶é—´</span>
</span></span><span class="line"><span class="cl">    keepalive_timeout 65<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># å¼€å¯gzipå‹ç¼©</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># gzip on;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># å¼€å¯gzipå‹ç¼©çš„æœ€å°æ–‡ä»¶å¤§å°</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># gzip_min_length 1k;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># gzipå‹ç¼©çº§åˆ«ï¼Œ1-9ï¼Œçº§åˆ«è¶Šé«˜å‹ç¼©ç‡è¶Šé«˜ï¼Œä½†æ˜¯æ¶ˆè€—CPUèµ„æºä¹Ÿè¶Šå¤š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># gzip_comp_level 2;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># gzipå‹ç¼©æ–‡ä»¶ç±»å‹</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># upstreamæŒ‡ä»¤ç”¨äºå®šä¹‰ä¸€ç»„æœåŠ¡å™¨ï¼Œä¸€èˆ¬ç”¨æ¥é…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡</span>
</span></span><span class="line"><span class="cl">    upstream www.example.com <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ip_hashæŒ‡ä»¤ç”¨äºè®¾ç½®è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼Œip_hashè¡¨ç¤ºä½¿ç”¨å®¢æˆ·ç«¯çš„IPè¿›è¡Œhashï¼Œè¿™æ ·å¯ä»¥ä¿è¯åŒä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ¯æ¬¡éƒ½ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ï¼Œè§£å†³äº†sessionå…±äº«çš„é—®é¢˜</span>
</span></span><span class="line"><span class="cl">        ip_hash<span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># weight ç”¨äºè®¾ç½®æƒé‡ï¼Œæƒé‡è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§</span>
</span></span><span class="line"><span class="cl">        server 192.168.50.11:80 <span class="nv">weight</span><span class="o">=</span>3<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server 192.168.50.12:80<span class="p">;</span>
</span></span><span class="line"><span class="cl">        server 192.168.50.13:80<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    server <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># å‚è€ƒserverå—çš„é…ç½®</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="134-serverå—">1.3.4 serverå—
</h3><p>serverå—æ˜¯é…ç½®è™šæ‹Ÿä¸»æœºçš„ï¼Œâ¼€ä¸ªhttpå—å¯ä»¥åŒ…å«å¤šä¸ªserverå—ï¼Œæ¯ä¸ªserverå—å°±æ˜¯â¼€ä¸ªè™šæ‹Ÿä¸»æœºã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ç›‘å¬IPå’Œç«¯å£</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listençš„æ ¼å¼ä¸ºï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listen [ip]:port [default_server] [ssl] [http2] [spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number];</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listenæŒ‡ä»¤éå¸¸çµæ´»ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªIPå’Œç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸‹é¢æ˜¯å‡ ä¸ªå®é™…çš„ä¾‹å­ï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listen 127.0.0.1:80; # ç›‘å¬æ¥è‡ª127.0.0.1çš„80ç«¯å£çš„è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listen 80; # ç›‘å¬æ¥è‡ªæ‰€æœ‰IPçš„80ç«¯å£çš„è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listen *:80; # ç›‘å¬æ¥è‡ªæ‰€æœ‰IPçš„80ç«¯å£çš„è¯·æ±‚ï¼ŒåŒä¸Š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># listen 127.0.0.1; # ç›‘å¬æ¥è‡ªæ¥è‡ª127.0.0.1çš„80ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º80</span>
</span></span><span class="line"><span class="cl">    listen 80<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># server_name ç”¨æ¥æŒ‡å®šè™šæ‹Ÿä¸»æœºçš„åŸŸåï¼Œå¯ä»¥ä½¿ç”¨ç²¾ç¡®åŒ¹é…ã€é€šé…ç¬¦åŒ¹é…å’Œæ­£åˆ™åŒ¹é…ç­‰æ–¹å¼</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># server_name example.org www.example.org; # ç²¾ç¡®åŒ¹é…</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># server_name *.example.org; # é€šé…ç¬¦åŒ¹é…</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># server_name ~^www\d+\.example\.net$; # æ­£åˆ™åŒ¹é…</span>
</span></span><span class="line"><span class="cl">    server_name localhost<span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># locationå—ç”¨æ¥é…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä¸€ä¸ªserverå—å¯ä»¥åŒ…å«å¤šä¸ªlocationå—ï¼Œæ¯ä¸ªlocationå—å°±æ˜¯ä¸€ä¸ªè¯·æ±‚è·¯ç”±</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># locationå—çš„æ ¼å¼æ˜¯ï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># location [=|~|~*|^~] /uri/ { ... }</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># = è¡¨ç¤ºç²¾ç¡®åŒ¹é…ï¼Œåªæœ‰å®Œå…¨åŒ¹é…ä¸Šæ‰èƒ½ç”Ÿæ•ˆ</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ~ è¡¨ç¤ºåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ~* è¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é…</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ^~ è¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†åŒ¹é…å…¶ä»–location</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># /uri/ è¡¨ç¤ºè¯·æ±‚çš„URIï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># { ... } è¡¨ç¤ºlocationå—çš„é…ç½®å†…å®¹</span>
</span></span><span class="line"><span class="cl">    location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># rootæŒ‡ä»¤ç”¨äºæŒ‡å®šè¯·æ±‚çš„æ ¹ç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span> <span class="c1"># æ ¹ç›®å½•</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># indexæŒ‡ä»¤ç”¨äºæŒ‡å®šé»˜è®¤æ–‡ä»¶ï¼Œå¦‚æœè¯·æ±‚çš„æ˜¯ç›®å½•ï¼Œåˆ™ä¼šåœ¨ç›®å½•ä¸‹æŸ¥æ‰¾é»˜è®¤æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">        index index.html index.htm<span class="p">;</span> <span class="c1"># é»˜è®¤æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ä¸‹é¢æ˜¯ä¸€äº›locationçš„ç¤ºä¾‹ï¼š</span>
</span></span><span class="line"><span class="cl">    <span class="nv">location</span> <span class="o">=</span> / <span class="o">{</span> <span class="c1"># ç²¾ç¡®åŒ¹é…è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">        index index.html index.htm<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    location ^~ /images/ <span class="o">{</span> <span class="c1"># åŒ¹é…ä»¥/images/å¼€å¤´çš„è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    location ~* <span class="se">\.</span><span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="o">)</span>$ <span class="o">{</span> <span class="c1"># åŒ¹é…ä»¥gifã€jpgæˆ–è€…jpegç»“å°¾çš„è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    location !~ <span class="se">\.</span><span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="o">)</span>$ <span class="o">{</span> <span class="c1"># ä¸åŒ¹é…ä»¥gifã€jpgæˆ–è€…jpegç»“å°¾çš„è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    location !~* <span class="se">\.</span><span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="o">)</span>$ <span class="o">{</span> <span class="c1"># ä¸åŒ¹é…ä»¥gifã€jpgæˆ–è€…jpegç»“å°¾çš„è¯·æ±‚</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># error_page ç”¨äºæŒ‡å®šé”™è¯¯é¡µé¢ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ä¾æ¬¡æŸ¥æ‰¾</span>
</span></span><span class="line"><span class="cl">    error_page <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span> /50x.html<span class="p">;</span> <span class="c1"># é”™è¯¯é¡µé¢</span>
</span></span><span class="line"><span class="cl">    <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
</span></span><span class="line"><span class="cl">        root /usr/share/nginx/html<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="14-nginxå¸¸ç”¨å‘½ä»¤">1.4 Nginxå¸¸ç”¨å‘½ä»¤
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">systemctl start nginx 	<span class="c1"># å¯åŠ¨Nginx (é»˜è®¤å·²ç»å¯åŠ¨)</span>
</span></span><span class="line"><span class="cl">systemctl stop nginx	<span class="c1"># å…³é—­Nginx</span>
</span></span><span class="line"><span class="cl">systemctl status nginx 	<span class="c1"># æŸ¥çœ‹NginxçŠ¶æ€</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo nginx -t 			<span class="c1"># æ£€æŸ¥Nginxé…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®</span>
</span></span><span class="line"><span class="cl">sudo nginx -s reload	<span class="c1"># é‡æ–°åŠ è½½Nginxé…ç½®</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo nginx 				<span class="c1"># å¯åŠ¨Nginx</span>
</span></span><span class="line"><span class="cl">sudo nginx -c filename 	<span class="c1"># æŒ‡å®šé…ç½®â½‚ä»¶</span>
</span></span><span class="line"><span class="cl">nginx -V 				<span class="c1"># æŸ¥çœ‹Nginxçš„ç‰ˆæœ¬å’Œç¼–è¯‘å‚æ•°ç­‰ä¿¡æ¯</span>
</span></span><span class="line"><span class="cl">sudo nginx -s quit 		<span class="c1"># ä¼˜é›…åœâ½ŒNginx</span>
</span></span><span class="line"><span class="cl">sudo nginx -s stop 		<span class="c1"># å¿«é€Ÿåœâ½ŒNginx</span>
</span></span><span class="line"><span class="cl">sudo nginx -s reopen 	<span class="c1"># é‡æ–°æ‰“å¼€â½‡å¿—â½‚ä»¶</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆ°æ­¤ä½ç½®ï¼ŒNginxå°±ç»“æŸå•¦ï¼Œé©¬ä¸Šå¼€å§‹æˆ‘ä»¬çš„SSLè¯ä¹¦ä¹‹æ—…å§ã€‚</p>
<h1 id="2-certbot-ç”³è¯·sslè¯ä¹¦">2. Certbot ç”³è¯·SSLè¯ä¹¦
</h1><p><strong>Certbot</strong> æ˜¯ä¸€ä¸ªç”± Electronic Frontier Foundation (EFF) å¼€å‘çš„å…è´¹ã€å¼€æºçš„å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–åœ¨ Web æœåŠ¡å™¨ä¸Šéƒ¨ç½² SSL/TLS è¯ä¹¦ã€‚SSL/TLS è¯ä¹¦æ˜¯ç”¨äºåŠ å¯†ç½‘ç«™ä¸ç”¨æˆ·ä¹‹é—´ä¼ è¾“çš„æ•°æ®ï¼Œç¡®ä¿æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚</p>
<p>Certbot æ”¯æŒå¤§å¤šæ•°å¸¸è§çš„ Web æœåŠ¡å™¨ï¼ŒåŒ…æ‹¬ Apacheã€Nginxã€IIS ç­‰ã€‚</p>
<h2 id="21-å®‰è£…-certbot">2.1 å®‰è£… certbot
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># debian</span>
</span></span><span class="line"><span class="cl">sudo apt update
</span></span><span class="line"><span class="cl"><span class="c1"># æ·»åŠ è½¯ä»¶æº</span>
</span></span><span class="line"><span class="cl">sudo apt install software-properties-common
</span></span><span class="line"><span class="cl">sudo add-apt-repository ppa:certbot/certbot
</span></span><span class="line"><span class="cl"><span class="c1"># å®‰è£…certbot</span>
</span></span><span class="line"><span class="cl">sudo apt install certbot
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># centos æ²¡ç”¨ï¼Œä¸å¤ªæ¸…æ¥šï¼Œåº”è¯¥ç±»ä¼¼äºdebian</span>
</span></span><span class="line"><span class="cl">sudo yum update
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ­¤å¤„çœç•¥æ·»åŠ è½¯ä»¶æºï¼Œè¯·è‡ªå·±è®°å¾—æ·»åŠ ã€‚ã€‚ã€‚
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo yum install certbot
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>è¿™é‡Œæ³¨æ„ï¼šä¸€å®šè¦æ·»åŠ è½¯ä»¶æºï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ certbotï¼Œå¦åˆ™åé¢æç¤ºå®‰è£…dnsæ’ä»¶æœ‰é—®é¢˜</p>
</blockquote>
<p>å®‰è£…å®Œæˆï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ <code>certbot --version</code>ï¼Œç›®å‰æ˜¯ 2.9.0</p>
<blockquote>
<p>å®˜æ–¹ä½¿ç”¨snapå®‰è£…çš„æ•™ç¨‹ï¼š
<a class="link" href="https://certbot.eff.org/instructions?ws=nginx&amp;os=debianbuster"  target="_blank" rel="noopener"
    >https://certbot.eff.org/instructions?ws=nginx&os=debianbuster</a></p>
</blockquote>
<h2 id="22-ç”³è¯·åŸŸåè¯ä¹¦">2.2 ç”³è¯·åŸŸåè¯ä¹¦
</h2><p>ä½¿ç”¨certbot æ¥ç”³è¯· Let&rsquo;s Encryptå…è´¹CAçš„SSLè¯ä¹¦</p>
<blockquote>
<p>å®˜ç½‘æ•™ç¨‹
<a class="link" href="https://eff-certbot.readthedocs.io/en/latest/using.html#getting-certificates-and-choosing-plugins"  target="_blank" rel="noopener"
    >https://eff-certbot.readthedocs.io/en/latest/using.html#getting-certificates-and-choosing-plugins</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># æ¯”å¦‚ï¼Œå®é™…æˆ‘æ²¡ç”¨ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸‹é¢çš„dnsæ’ä»¶æ¥è·å–</span>
</span></span><span class="line"><span class="cl">certbot certonly --webroot -w /path/to/your/website -d yourdomain.com
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨Webæ ¹ç›®å½•<code>/path/to/your/website</code>ä¸­çš„æ–‡ä»¶éªŒè¯æ‚¨æ‹¥æœ‰<code>yourdomain.com</code>çš„æ§åˆ¶æƒï¼Œå¹¶ä¸ºè¯¥åŸŸåè·å–SSLè¯ä¹¦ã€‚</p>
<h2 id="23-dnsè·å–sslæ³›åŸŸåè¯ä¹¦æ¨è">2.3 DNSè·å–SSLæ³›åŸŸåè¯ä¹¦ï¼ˆæ¨èï¼‰
</h2><p>DNSè·å–è¯ä¹¦çš„å¥½å¤„åœ¨äºå¯ä»¥ç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯åƒ <code>*.seektao.cc</code>ä¹Ÿå°±æ˜¯ä¸€æ¬¡ç”³è¯·ï¼Œåˆ°å¤„ä½¿ç”¨ï¼Œæ–¹ä¾¿è‡³æã€‚</p>
<h3 id="231-certbot-dns-dnspod">2.3.1 certbot-dns-dnspod
</h3><p>certbot-dns-dnspod æ˜¯dnspodçš„æ’ä»¶ï¼Œé»˜è®¤çš„certbotæ˜¯æ²¡æœ‰çš„ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…</p>
<blockquote>
<p>Githubåœ°å€</p>
<p><a class="link" href="https://github.com/tengattack/certbot-dns-dnspod"  target="_blank" rel="noopener"
    >https://github.com/tengattack/certbot-dns-dnspod</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># pip</span>
</span></span><span class="line"><span class="cl">sudo pip install git+https://github.com/tengattack/certbot-dns-dnspod.git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># snap æœ¬æ¬¡æ²¡æœ‰é‡‡ç”¨</span>
</span></span><span class="line"><span class="cl">sudo snap install certbot-dns-dnspod
</span></span><span class="line"><span class="cl">sudo snap <span class="nb">set</span> certbot trust-plugin-with-root<span class="o">=</span>ok
</span></span><span class="line"><span class="cl">sudo snap connect certbot:plugin certbot-dns-dnspod
</span></span></code></pre></td></tr></table>
</div>
</div><p>å®‰è£…å®Œæˆä¹‹åæ–°å»ºä¸€ä¸ª .iniæ–‡ä»¶ï¼Œæ¯”å¦‚ /etc/certbot/dnspod.ini</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir /etc/certbot
</span></span><span class="line"><span class="cl">sudo touch /etc/certbot/dnspod.ini
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¾‘ dnspod.iniï¼Œå¡«å…¥ä¸‹é¢çš„å†…å®¹ï¼Œ<a class="link" href="https://console.dnspod.cn/account/token/token"  target="_blank" rel="noopener"
    >ç‚¹æ­¤è·³è½¬åˆ°dnspod api ç”³è¯·é¡µé¢</a>ï¼Œæ³¨æ„ç”³è¯·çš„æ˜¯dnspod token</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-vim" data-lang="vim"><span class="line"><span class="cl"><span class="nx">dns_dnspod_api_id</span> <span class="p">=</span> <span class="m">12345</span>
</span></span><span class="line"><span class="cl"><span class="nx">dns_dnspod_api_token</span> <span class="p">=</span> <span class="m">1234567890</span>abcdef<span class="m">1234567890</span>abcdef
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo chmod <span class="m">600</span> /etc/certbot/dnspod.ini
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”³è¯·ï¼Œæ›¿æ¢ä¸ºè‡ªå·±çš„åŸŸå</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo certbot certonly -a dns-dnspod <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --dns-dnspod-credentials /etc/certbot/dnspod.ini <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -d seektao.cc <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    -d <span class="s2">&#34;*.seektao.cc&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¥ç€å°±æ˜¯:
</span></span><span class="line"><span class="cl">è¾“å…¥é‚®ç®±ï¼Œ
</span></span><span class="line"><span class="cl">æ˜¯å¦åŒæ„æ³¨å†Œacmeï¼ˆé€‰Yï¼‰ï¼Œ
</span></span><span class="line"><span class="cl">æ˜¯å¦åŒæ„å‘é€é‚®ä»¶ã€‚ã€‚ã€‚çœ‹è‡ªå·±å§
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æ¥ç€ç­‰å¾…ï¼Œç­‰å¾…ã€‚ã€‚å°±å®Œæˆäº†
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°è¯ä¹¦æ–‡ä»¶ä¿å­˜åœ¨  <code>/etc/letsencrypt/live</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># å…¶ä¸­ </span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>cert name<span class="o">]</span>/privkey.pemï¼šè¯ä¹¦çš„ç§é’¥ã€‚
</span></span><span class="line"><span class="cl"><span class="o">[</span>cert name<span class="o">]</span>/fullchain.pemï¼šåœ¨å¤§å¤šæ•°æœåŠ¡å™¨è½¯ä»¶ä¸­ä½¿ç”¨çš„è¯ä¹¦æ–‡ä»¶ã€‚
</span></span><span class="line"><span class="cl"><span class="o">[</span>cert name<span class="o">]</span>/chain.pemï¼šåœ¨Nginx &gt;<span class="o">=</span>1.3.7 ä¸­ç”¨äº OCSP staplingã€‚
</span></span><span class="line"><span class="cl"><span class="o">[</span>cert name<span class="o">]</span>/cert.pemï¼šä¼šç ´åè®¸å¤šæœåŠ¡å™¨é…ç½®ï¼Œä¸åº”åœ¨æœªè¿›ä¸€æ­¥é˜…è¯»æ–‡æ¡£çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç”¨åˆ°  privkey.pemï¼Œfullchain.pemå³å¯ã€‚</p>
<p>æ­¤èŠ‚å…³äº dnspod ç”³è¯·sslè¯ä¹¦å°±æ˜¯å¦‚æ­¤ã€‚</p>
<h2 id="24-è‡ªåŠ¨ç»­æœŸ">2.4 è‡ªåŠ¨ç»­æœŸ
</h2><p>è‡ªåŠ¨ç»­æœŸæ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å³å¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># è®¾ç½®å®šæ—¶ä»»åŠ¡</span>
</span></span><span class="line"><span class="cl">sudo crontab -e
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æ¯æœˆ1å·çš„åˆå¤œæ‰§è¡Œ certbot renew å‘½ä»¤æ¥ç»­è®¢è¯ä¹¦</span>
</span></span><span class="line"><span class="cl"><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> * * /usr/local/bin/certbot renew
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>éœ€è¦æ³¨æ„è‡ªå·±çš„certbotæ‰§è¡Œè·¯å¾„æ˜¯å¦æ­£ç¡®</p>
<p><code>which certbot</code> å¯ä»¥çœ‹åˆ°certbotæ‰§è¡Œè·¯å¾„</p>
</blockquote>
<blockquote>
<p>å…³äºç»­æœŸçš„æ›´å¤šæ–‡æ¡£å¯ä»¥è§‚çœ‹</p>
<p><a class="link" href="https://eff-certbot.readthedocs.io/en/latest/using.html#setting-up-automated-renewal"  target="_blank" rel="noopener"
    >https://eff-certbot.readthedocs.io/en/latest/using.html#setting-up-automated-renewal</a></p>
</blockquote>
<h1 id="3-nginxä¸€é”®ç”Ÿæˆæ¨¡æ¿">3. Nginxä¸€é”®ç”Ÿæˆæ¨¡æ¿
</h1><h2 id="31-éœ€æ±‚1">3.1 éœ€æ±‚1
</h2><p>è¿™ä¸ªéœ€æ±‚åœ¨äºæˆ‘ä½¿ç”¨Nginxä½œä¸ºåä»£æœåŠ¡å™¨ï¼Œæ¯æ–°å¢ä¸€ä¸ªæœåŠ¡ï¼Œå°±è¦æ‰‹åŠ¨å»æ–°å¢ä¸€ä¸ªnginxæ–‡ä»¶ï¼Œè€Œä¸”æˆ‘ä¸»è¦ä½¿ç”¨çš„æ˜¯äºŒçº§åŸŸååŠ ç«¯å£çš„æ¨¡å¼ï¼Œé…åˆä½¿ç”¨ æ³›åŸŸåè¯ä¹¦æ¥ç¼–å†™è¿™ä¸ªè„šæœ¬å°±å¾ˆæ–¹ä¾¿äº†ã€‚</p>
<p>ç°åœ¨æƒ³è¦å®ç°è¾“å…¥ <code>è„šæœ¬æ–‡ä»¶ åŸŸå ç«¯å£ </code> å°±ä¼šåœ¨ <code>/etc/nginx/conf.d/</code>ä¸‹æ–°å¢ä¸€ä¸ªä»¥åŸŸåå¼€å¤´çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ./generate_nginx_simple_template.sh test1.seektao.cc <span class="m">5980</span>
</span></span><span class="line"><span class="cl">Do you want to reload Nginx configuration? <span class="o">(</span>y/n<span class="o">)</span> y
</span></span><span class="line"><span class="cl">Reloading Nginx configuration...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ll /etc/nginx/conf.d/test1.conf 
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">965</span> Mar <span class="m">25</span> 13:01 /etc/nginx/conf.d/test1.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ¿çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cat /etc/nginx/conf.d/test1.conf 
</span></span><span class="line"><span class="cl">server <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    listen 80<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    server_name test1.seektao.cc<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="m">301</span> <span class="nv">$scheme</span>://test1.seektao.cc<span class="nv">$request_uri</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">server <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    listen <span class="m">443</span> ssl http2<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    server_name test1.seektao.cc<span class="p">;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># SSL è¯ä¹¦é…ç½®  </span>
</span></span><span class="line"><span class="cl">    ssl_certificate /etc/letsencrypt/live/seektao.cc/fullchain.pem<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    ssl_certificate_key /etc/letsencrypt/live/seektao.cc/privkey.pem<span class="p">;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># å®‰å…¨è®¾ç½®  </span>
</span></span><span class="line"><span class="cl">    ssl_protocols TLSv1.2 TLSv1.3<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    ssl_ciphers HIGH:!aNULL:!MD5<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    ssl_prefer_server_ciphers on<span class="p">;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># åå‘ä»£ç†  </span>
</span></span><span class="line"><span class="cl">    location / <span class="o">{</span>  
</span></span><span class="line"><span class="cl">        proxy_pass http://127.0.0.1:5980/<span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header X-Forwarded-Proto <span class="nv">$scheme</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="o">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># æ—¥å¿—é…ç½®  </span>
</span></span><span class="line"><span class="cl">    access_log /var/log/nginx/test1.seektao.cc.access.log<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    error_log /var/log/nginx/test1.seektao.cc.error.log<span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="311--è„šæœ¬çš„é…ç½®">3.1.1  è„šæœ¬çš„é…ç½®
</h3><p><strong>ä½¿ç”¨è¿™ä¸ªè„šæœ¬è¯·å…ˆç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼Œæˆ–è€…ä½ è‡ªå·±å†ä¿®æ”¹é…ç½®æ–‡ä»¶çš„è¯ä¹¦ä½ç½®ã€‚</strong></p>
<p><code>vim generate_nginx_simple_template.sh</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash  
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥å‚æ•°æ•°é‡  </span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$#</span><span class="s2">&#34;</span> -ne <span class="m">2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> &lt;domain&gt; &lt;application_port&gt;&#34;</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="nv">DOMAIN</span><span class="o">=</span><span class="nv">$1</span>  
</span></span><span class="line"><span class="cl"><span class="nv">APPLICATION_PORT</span><span class="o">=</span><span class="nv">$2</span>  
</span></span><span class="line"><span class="cl"><span class="nv">PORT_HTTP</span><span class="o">=</span><span class="m">80</span>  
</span></span><span class="line"><span class="cl"><span class="nv">PORT_HTTPS</span><span class="o">=</span><span class="m">443</span>  
</span></span><span class="line"><span class="cl"><span class="nv">CERT_DOMAIN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$DOMAIN</span><span class="s2">&#34;</span> <span class="p">|</span> awk -F. <span class="s1">&#39;{print $(NF-1)&#34;.&#34;$NF}&#39;</span><span class="k">)</span>  
</span></span><span class="line"><span class="cl"><span class="nv">CONF_FILE_PREFIX</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$DOMAIN</span><span class="s2">&#34;</span> <span class="p">|</span> awk -F. <span class="s1">&#39;{print $1}&#39;</span><span class="k">)</span>  
</span></span><span class="line"><span class="cl"><span class="nv">CONF_FILE</span><span class="o">=</span><span class="s2">&#34;/etc/nginx/conf.d/</span><span class="si">${</span><span class="nv">CONF_FILE_PREFIX</span><span class="si">}</span><span class="s2">.conf&#34;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># ç”Ÿæˆ Nginx é…ç½®å†…å®¹  </span>
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF &gt; $CONF_FILE
</span></span></span><span class="line"><span class="cl"><span class="s">server {  
</span></span></span><span class="line"><span class="cl"><span class="s">    listen $PORT_HTTP;  
</span></span></span><span class="line"><span class="cl"><span class="s">    server_name $DOMAIN;  
</span></span></span><span class="line"><span class="cl"><span class="s">    return 301 \$scheme://$DOMAIN\$request_uri;  
</span></span></span><span class="line"><span class="cl"><span class="s">}  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">server {  
</span></span></span><span class="line"><span class="cl"><span class="s">    listen $PORT_HTTPS ssl http2;  
</span></span></span><span class="line"><span class="cl"><span class="s">    server_name $DOMAIN;  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # SSL è¯ä¹¦é…ç½®  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_certificate /etc/letsencrypt/live/$CERT_DOMAIN/fullchain.pem;  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_certificate_key /etc/letsencrypt/live/$CERT_DOMAIN/privkey.pem;  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # å®‰å…¨è®¾ç½®  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_protocols TLSv1.2 TLSv1.3;  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_ciphers HIGH:!aNULL:!MD5;  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_prefer_server_ciphers on;  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # åå‘ä»£ç†  
</span></span></span><span class="line"><span class="cl"><span class="s">    location / {  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_pass http://127.0.0.1:$APPLICATION_PORT/;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header Host \$host;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header X-Real-IP \$remote_addr;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header X-Forwarded-Proto \$scheme;  
</span></span></span><span class="line"><span class="cl"><span class="s">    }  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # æ—¥å¿—é…ç½®  
</span></span></span><span class="line"><span class="cl"><span class="s">    access_log /var/log/nginx/$DOMAIN.access.log;  
</span></span></span><span class="line"><span class="cl"><span class="s">    error_log /var/log/nginx/$DOMAIN.error.log;  
</span></span></span><span class="line"><span class="cl"><span class="s">}  
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶æ˜¯å¦æˆåŠŸåˆ›å»º  </span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">CONF_FILE</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Error: Failed to create temporary configuration file.&#34;</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># read -p &#34;Do you want to modify the configuration file before saving? (y/n) &#34; choice  </span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ ¹æ®ç”¨æˆ·é€‰æ‹©æ‰§è¡Œç›¸åº”æ“ä½œ  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># case &#34;$choice&#34; in  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#     y|Y )  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         # ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨è®©ç”¨æˆ·ä¿®æ”¹é…ç½®æ–‡ä»¶  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         echo &#34;Editing configuration file...&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         vim &#34;${CONF_FILE}&#34; # æˆ–è€…ä½¿ç”¨ä½ å–œæ¬¢çš„å…¶ä»–æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¦‚ nano  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         ;;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#     n|N )  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         # ç›´æ¥å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         echo &#34;Saving configuration file without modification...&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         mv &#34;${CONF_FILE}&#34; &#34;${CONF_FILE}&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         ;;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#     * )  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         echo &#34;Invalid choice. Exiting...&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         exit 1  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         ;;  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># esac  </span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥ SSL è¯ä¹¦è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨ç”³è¯·  </span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -e <span class="s2">&#34;/etc/letsencrypt/live/</span><span class="nv">$CERT_DOMAIN</span><span class="s2">/fullchain.pem&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Warning: SSL certificate for </span><span class="nv">$CERT_DOMAIN</span><span class="s2"> does not exist.&#34;</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Please use certbot or another tool to manually obtain a certificate for </span><span class="nv">$CERT_DOMAIN</span><span class="s2">.&#34;</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦é‡æ–°åŠ è½½ Nginx é…ç½®  </span>
</span></span><span class="line"><span class="cl"><span class="nb">read</span> -p <span class="s2">&#34;Do you want to reload Nginx configuration? (y/n) &#34;</span> reload_choice  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$reload_choice</span><span class="s2">&#34;</span> in  
</span></span><span class="line"><span class="cl">    y<span class="p">|</span>Y <span class="o">)</span>  
</span></span><span class="line"><span class="cl">        <span class="c1"># é‡æ–°åŠ è½½ Nginx é…ç½®  </span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Reloading Nginx configuration...&#34;</span>  
</span></span><span class="line"><span class="cl">        sudo nginx -s reload  
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>  
</span></span><span class="line"><span class="cl">    n<span class="p">|</span>N <span class="o">)</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Nginx configuration will not be reloaded.&#34;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>  
</span></span><span class="line"><span class="cl">    * <span class="o">)</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Invalid choice. Exiting...&#34;</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>  
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="32-éœ€æ±‚2">3.2 éœ€æ±‚2
</h2><p><strong>æ­¤å†…å®¹ä¸ºæ›´æ–°å†…å®¹ï¼š
å’Œéœ€æ±‚1ä¸åŒçš„æ˜¯ï¼šç”Ÿæˆçš„nginxé…ç½®æ–‡ä»¶ä¸º<code>åŸŸå.conf</code>è€Œé <code>åŸŸåå‰ç¼€.conf</code>
è¿™ä¹ˆåšçš„ç›®çš„æ˜¯æˆ‘åœ¨ä½¿ç”¨å¤šä¸ªä¸åŒåŸŸåæ–¹ä¾¿åŒºåˆ†é…ç½®æ–‡ä»¶ï¼Œç‰¹æ­¤æ›´æ”¹ã€‚</strong></p>
<hr>
<p>ä»¥ä¸‹å†…å®¹ä¸ºæ­£æ–‡ï¼šä»éœ€æ±‚1å¤åˆ¶æ›´æ”¹</p>
<hr>
<p>è¿™ä¸ªéœ€æ±‚åœ¨äºæˆ‘ä½¿ç”¨Nginxä½œä¸ºåä»£æœåŠ¡å™¨ï¼Œæ¯æ–°å¢ä¸€ä¸ªæœåŠ¡ï¼Œå°±è¦æ‰‹åŠ¨å»æ–°å¢ä¸€ä¸ªnginxæ–‡ä»¶ï¼Œè€Œä¸”æˆ‘ä¸»è¦ä½¿ç”¨çš„æ˜¯äºŒçº§åŸŸååŠ ç«¯å£çš„æ¨¡å¼ï¼Œé…åˆä½¿ç”¨ æ³›åŸŸåè¯ä¹¦æ¥ç¼–å†™è¿™ä¸ªè„šæœ¬å°±å¾ˆæ–¹ä¾¿äº†ã€‚</p>
<p>ç°åœ¨æƒ³è¦å®ç°è¾“å…¥ <code>è„šæœ¬æ–‡ä»¶ åŸŸå ç«¯å£ </code> å°±ä¼šåœ¨ <code>/etc/nginx/conf.d/</code>ä¸‹æ–°å¢ä¸€ä¸ªä»¥<strong>å…¨åŸŸå</strong>å¼€å¤´çš„é…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ./generate_nginx_simple_template.sh test1.seektao.cc <span class="m">5980</span>
</span></span><span class="line"><span class="cl">Do you want to reload Nginx configuration? <span class="o">(</span>y/n<span class="o">)</span> y
</span></span><span class="line"><span class="cl">Reloading Nginx configuration...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ll /etc/nginx/conf.d/test1.seektao.cc.conf 
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">965</span> Mar <span class="m">25</span> 13:01 /etc/nginx/conf.d/test1.seektao.cc.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ¿çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cat /etc/nginx/conf.d/test1.seektao.cc.conf 
</span></span><span class="line"><span class="cl">server <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    listen 80<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    server_name test1.seektao.cc<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="m">301</span> <span class="nv">$scheme</span>://test1.seektao.cc<span class="nv">$request_uri</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">server <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    listen <span class="m">443</span> ssl http2<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    server_name test1.seektao.cc<span class="p">;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># SSL è¯ä¹¦é…ç½®  </span>
</span></span><span class="line"><span class="cl">    ssl_certificate /etc/letsencrypt/live/seektao.cc/fullchain.pem<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    ssl_certificate_key /etc/letsencrypt/live/seektao.cc/privkey.pem<span class="p">;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># å®‰å…¨è®¾ç½®  </span>
</span></span><span class="line"><span class="cl">    ssl_protocols TLSv1.2 TLSv1.3<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    ssl_ciphers HIGH:!aNULL:!MD5<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    ssl_prefer_server_ciphers on<span class="p">;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># åå‘ä»£ç†  </span>
</span></span><span class="line"><span class="cl">    location / <span class="o">{</span>  
</span></span><span class="line"><span class="cl">        proxy_pass http://127.0.0.1:5980/<span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        proxy_set_header X-Forwarded-Proto <span class="nv">$scheme</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="o">}</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="c1"># æ—¥å¿—é…ç½®  </span>
</span></span><span class="line"><span class="cl">    access_log /var/log/nginx/test1.seektao.cc.access.log<span class="p">;</span>  
</span></span><span class="line"><span class="cl">    error_log /var/log/nginx/test1.seektao.cc.error.log<span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="321--è„šæœ¬çš„é…ç½®">3.2.1  è„šæœ¬çš„é…ç½®
</h3><p><strong>ä½¿ç”¨è¿™ä¸ªè„šæœ¬è¯·å…ˆç”³è¯·æ³›åŸŸåè¯ä¹¦ï¼Œæˆ–è€…ä½ è‡ªå·±å†ä¿®æ”¹é…ç½®æ–‡ä»¶çš„è¯ä¹¦ä½ç½®ã€‚</strong></p>
<p><code>vim generate_nginx_simple_template1.sh</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash  
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>  
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥å‚æ•°æ•°é‡  </span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$#</span><span class="s2">&#34;</span> -ne <span class="m">2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Usage: </span><span class="nv">$0</span><span class="s2"> &lt;domain&gt; &lt;application_port&gt;&#34;</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="nv">DOMAIN</span><span class="o">=</span><span class="nv">$1</span>  
</span></span><span class="line"><span class="cl"><span class="nv">APPLICATION_PORT</span><span class="o">=</span><span class="nv">$2</span>  
</span></span><span class="line"><span class="cl"><span class="nv">PORT_HTTP</span><span class="o">=</span><span class="m">80</span>  
</span></span><span class="line"><span class="cl"><span class="nv">PORT_HTTPS</span><span class="o">=</span><span class="m">443</span>  
</span></span><span class="line"><span class="cl"><span class="nv">CERT_DOMAIN</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$DOMAIN</span><span class="s2">&#34;</span> <span class="p">|</span> awk -F. <span class="s1">&#39;{print $(NF-1)&#34;.&#34;$NF}&#39;</span><span class="k">)</span>  
</span></span><span class="line"><span class="cl"><span class="nv">CONF_FILE_PREFIX</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="nv">$DOMAIN</span><span class="s2">&#34;</span><span class="k">)</span>  
</span></span><span class="line"><span class="cl"><span class="nv">CONF_FILE</span><span class="o">=</span><span class="s2">&#34;/etc/nginx/conf.d/</span><span class="si">${</span><span class="nv">CONF_FILE_PREFIX</span><span class="si">}</span><span class="s2">.conf&#34;</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># ç”Ÿæˆ Nginx é…ç½®å†…å®¹  </span>
</span></span><span class="line"><span class="cl">cat <span class="s">&lt;&lt;EOF &gt; $CONF_FILE
</span></span></span><span class="line"><span class="cl"><span class="s">server {  
</span></span></span><span class="line"><span class="cl"><span class="s">    listen $PORT_HTTP;  
</span></span></span><span class="line"><span class="cl"><span class="s">    server_name $DOMAIN;  
</span></span></span><span class="line"><span class="cl"><span class="s">    return 301 \$scheme://$DOMAIN\$request_uri;  
</span></span></span><span class="line"><span class="cl"><span class="s">}  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">server {  
</span></span></span><span class="line"><span class="cl"><span class="s">    listen $PORT_HTTPS ssl http2;  
</span></span></span><span class="line"><span class="cl"><span class="s">    server_name $DOMAIN;  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # SSL è¯ä¹¦é…ç½®  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_certificate /etc/letsencrypt/live/$CERT_DOMAIN/fullchain.pem;  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_certificate_key /etc/letsencrypt/live/$CERT_DOMAIN/privkey.pem;  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # å®‰å…¨è®¾ç½®  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_protocols TLSv1.2 TLSv1.3;  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_ciphers HIGH:!aNULL:!MD5;  
</span></span></span><span class="line"><span class="cl"><span class="s">    ssl_prefer_server_ciphers on;  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # åå‘ä»£ç†  
</span></span></span><span class="line"><span class="cl"><span class="s">    location / {  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_pass http://127.0.0.1:$APPLICATION_PORT/;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header Host \$host;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header X-Real-IP \$remote_addr;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;  
</span></span></span><span class="line"><span class="cl"><span class="s">        proxy_set_header X-Forwarded-Proto \$scheme;  
</span></span></span><span class="line"><span class="cl"><span class="s">    }  
</span></span></span><span class="line"><span class="cl"><span class="s">  
</span></span></span><span class="line"><span class="cl"><span class="s">    # æ—¥å¿—é…ç½®  
</span></span></span><span class="line"><span class="cl"><span class="s">    access_log /var/log/nginx/$DOMAIN.access.log;  
</span></span></span><span class="line"><span class="cl"><span class="s">    error_log /var/log/nginx/$DOMAIN.error.log;  
</span></span></span><span class="line"><span class="cl"><span class="s">}  
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶æ˜¯å¦æˆåŠŸåˆ›å»º  </span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -f <span class="s2">&#34;</span><span class="si">${</span><span class="nv">CONF_FILE</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Error: Failed to create temporary configuration file.&#34;</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># read -p &#34;Do you want to modify the configuration file before saving? (y/n) &#34; choice  </span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ ¹æ®ç”¨æˆ·é€‰æ‹©æ‰§è¡Œç›¸åº”æ“ä½œ  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># case &#34;$choice&#34; in  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#     y|Y )  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         # ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨è®©ç”¨æˆ·ä¿®æ”¹é…ç½®æ–‡ä»¶  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         echo &#34;Editing configuration file...&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         vim &#34;${CONF_FILE}&#34; # æˆ–è€…ä½¿ç”¨ä½ å–œæ¬¢çš„å…¶ä»–æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œå¦‚ nano  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         ;;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#     n|N )  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         # ç›´æ¥å°†ä¸´æ—¶æ–‡ä»¶ç§»åŠ¨åˆ°ç›®æ ‡ä½ç½®  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         echo &#34;Saving configuration file without modification...&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         mv &#34;${CONF_FILE}&#34; &#34;${CONF_FILE}&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         ;;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#     * )  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         echo &#34;Invalid choice. Exiting...&#34;  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         exit 1  </span>
</span></span><span class="line"><span class="cl"><span class="c1">#         ;;  </span>
</span></span><span class="line"><span class="cl"><span class="c1"># esac  </span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æ£€æŸ¥ SSL è¯ä¹¦è·¯å¾„æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨ç”³è¯·  </span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> ! -e <span class="s2">&#34;/etc/letsencrypt/live/</span><span class="nv">$CERT_DOMAIN</span><span class="s2">/fullchain.pem&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Warning: SSL certificate for </span><span class="nv">$CERT_DOMAIN</span><span class="s2"> does not exist.&#34;</span>  
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Please use certbot or another tool to manually obtain a certificate for </span><span class="nv">$CERT_DOMAIN</span><span class="s2">.&#34;</span>  
</span></span><span class="line"><span class="cl"><span class="k">fi</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="c1"># æç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦é‡æ–°åŠ è½½ Nginx é…ç½®  </span>
</span></span><span class="line"><span class="cl"><span class="nb">read</span> -p <span class="s2">&#34;Do you want to reload Nginx configuration? (y/n) &#34;</span> reload_choice  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="s2">&#34;</span><span class="nv">$reload_choice</span><span class="s2">&#34;</span> in  
</span></span><span class="line"><span class="cl">    y<span class="p">|</span>Y <span class="o">)</span>  
</span></span><span class="line"><span class="cl">        <span class="c1"># é‡æ–°åŠ è½½ Nginx é…ç½®  </span>
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Reloading Nginx configuration...&#34;</span>  
</span></span><span class="line"><span class="cl">        sudo nginx -s reload  
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>  
</span></span><span class="line"><span class="cl">    n<span class="p">|</span>N <span class="o">)</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Nginx configuration will not be reloaded.&#34;</span>  
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>  
</span></span><span class="line"><span class="cl">    * <span class="o">)</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Invalid choice. Exiting...&#34;</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>  
</span></span><span class="line"><span class="cl">        <span class="p">;;</span>  
</span></span><span class="line"><span class="cl"><span class="k">esac</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="4-åè¯">4. åè¯
</h1><p>åœ¨ç¼–å†™è¿™ç¯‡æ•™ç¨‹ä¹‹å‰ï¼Œæˆ‘ä¸€ç›´éƒ½æ˜¯ç”¨çš„æ˜¯ Nginx Proxy Manager ï¼ˆç®€ç§°NPMï¼‰å›¾å½¢åŒ–ç®¡ç†ç•Œé¢ï¼Œè§‰å¾—Nginxé…ç½®çœ‹ä¸æ‡‚ï¼Œå¤ªå¤æ‚ï¼Œå¯¹Nginxä¹Ÿä¸å¤ªæ‡‚ã€‚</p>
<p>æ•™ç¨‹çš„å‰ä¸€å¤©ï¼Œæˆ‘æƒ³ä½¿ç”¨Nginx Proxy Managerä¸ºåä»£çš„æœåŠ¡æ·»åŠ  locationç‰‡æ®µï¼Œå´ä¼šå¯¼è‡´æ·»åŠ äº†locationçš„æœåŠ¡æŒ‚æ‰ï¼Œä¸è®ºæ˜¯å›¾å½¢åŒ–æ·»åŠ è¿˜æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯æˆ‘çš„é…ç½®å§¿åŠ¿ä¸å¯¹ï¼Œæ·»åŠ çš„locationå†…å®¹æœ‰é”™ï¼Œåé¢æ‰¾äº†å¾ˆä¹…çš„èµ„æ–™ï¼Œå´æ²¡èƒ½æ‰¾åˆ°è§£å†³åŠæ³•ï¼Œæœ€åè¿˜æ˜¯åœ¨ NPM çš„Github issueså¾ˆå¤šäººå‡ºç°äº†è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”æ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„è§£å†³æ–¹æ¡ˆï¼ŒNPMçš„bugã€‚å”‰ï¼Œä¸€ä¸åšï¼ŒäºŒä¸ä¼‘ï¼Œä¸å¦‚ç›´æ¥ç”¨Nginxï¼Œè¿˜å°‘å»äº†NPMå æ®äº†ä¸€éƒ¨åˆ†å†…å­˜ã€‚</p>
<p>å®‰è£…Nginxçš„è¿‡ç¨‹è¿˜æ˜¯å¾ˆæ„‰å¿«çš„ã€‚ä½†æ˜¯å¯¹äºsslè¯ä¹¦æˆ‘åˆäº†è§£ç”šå°‘äº†ï¼Œå¯¹æ­¤åˆèŠ±è´¹äº†å¾ˆå¤šç²¾åŠ›å»äº†è§£ certbotï¼Œç»“æœaptå®‰è£…çš„certbotæ²¡æœ‰dnspodæ’ä»¶ï¼Ÿï¼Ÿæˆ‘ä¸€ä¸ªå¤§é—®å·ï¼Œåˆå¸è½½äº†aptæ–¹å¼å®‰è£…çš„certbotï¼Œå»å®‰è£…snapï¼Œé€šè¿‡snapå®‰è£…certbotï¼Œæˆ‘å‘ç° snapä¹Ÿæœ‰é—®é¢˜ï¼Ÿï¼Ÿä½†æ˜¯æ‰¾åˆ°äº†snapä¸ŠGitHubä¸Šçš„ dnspodæ’ä»¶ï¼Œä¹Ÿæ”¯æŒsnapï¼Œç„¶ååˆå¸è½½ certbotï¼Œsnapï¼Œé‡æ–°é€šè¿‡ apt å®‰è£… certbotï¼Œç„¶åä¸‹è½½dnspodï¼Œç»“æœåˆåœ¨ç”³è¯·è¯ä¹¦çš„æ—¶å€™å‡ºé”™äº†ã€‚åŸæ¥æˆ‘ä¸ºäº†ç®€ä¾¿ï¼Œdnspod.ini ç”¨çš„æ˜¯ NPMä¹‹å‰çš„é…ç½®ã€‚åæ¥æ”¹äº†å°±å¥½äº†ã€‚</p>
<p>ç°åœ¨åªå·®åä»£äº†ï¼Œä¸Šé¢çš„è„šæœ¬ä¹Ÿæ˜¯ä¸ºäº†æˆ‘åœ¨ NPMå·²ç»åä»£çš„æœåŠ¡è€Œå†™çš„ï¼Œæ¯•ç«Ÿä¸€ä¸ªä¸€ä¸ªå¤åˆ¶ç„¶åæ”¹ç«¯å£ä¹ŸæŒºéº»çƒ¦çš„ã€‚</p>
<p>å…¨æ–‡å®Œã€‚</p>
<p>åˆ¶ä½œä¸æ˜“ï¼Œå¦‚æœå¯¹æ‚¨æœ‰ä¸€ä¸¢ä¸¢å¸®åŠ©ï¼Œæ‚¨å¯ä»¥ç‚¹èµæ”¶è—è½¬å‘ï¼Œä¸€é”®ä¸‰è¿ï¼ŒğŸ¤ğŸ¤ï¼Œè°¢è°¢æ‚¨å’§~~</p>
<p>å¦‚éœ€è½¬è½½ï¼Œè¯·æ³¨æ˜å‡ºå¤„ã€‚</p>
<blockquote>
<p>åˆ›ä½œæ—¶é—´ï¼š2024-03-25 13:40</p>
<p>åˆ›ä½œè€…ï¼šmuyiacc</p>
</blockquote>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/nginx/">Nginx</a>
        
            <a href="/tags/ssl/">Ssl</a>
        
            <a href="/tags/certbot/">Certbot</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">ç›¸å…³æ–‡ç« </h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/2407014/">
        
        

        <div class="article-details">
            <h2 class="article-title">Nginxé…ç½®æ¨¡æ¿</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2405002/">
        
        

        <div class="article-details">
            <h2 class="article-title">acme.shç”³è¯·sslè¯ä¹¦</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2404001/">
        
        

        <div class="article-details">
            <h2 class="article-title">Certbotç”³è¯·åŸŸåçš„å¤šç§æ–¹å¼</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2403008/">
        
        

        <div class="article-details">
            <h2 class="article-title">opensslå°å°ä½¿ç”¨</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/2403005/">
        
        

        <div class="article-details">
            <h2 class="article-title">nginx-proxy-managerç”³è¯·è¯ä¹¦å¤±è´¥ä¹‹ç¼ºä¹zopeæ¨¡å—ã€å·²è§£å†³ã€‘</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <script
    src="https://giscus.app/client.js"
    data-repo="muyiacc/hugo-blog-public"
    data-repo-id="R_kgDOML6rcA"
    data-category="Announcements"
    data-category-id="DIC_kwDOML6rcM4ChQWO"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="top"
    data-theme="light"
    data-lang="en"
    crossorigin="anonymous"
    async
></script>
<script>
    function setGiscusTheme(theme) {
        let giscus = document.querySelector("iframe.giscus-frame");
        if (giscus) {
            giscus.contentWindow.postMessage(
                {
                    giscus: {
                        setConfig: {
                            theme: theme,
                        },
                    },
                },
                "https://giscus.app"
            );
        }
    }

    (function () {
        addEventListener("message", (e) => {
            if (event.origin !== "https://giscus.app") return;
            handler();
        });
        window.addEventListener("onColorSchemeChange", handler);

        function handler() {
            if (document.documentElement.dataset.scheme === "light") {
                setGiscusTheme('light');
            } else {
                setGiscusTheme('dark_dimmed');
            }
        }
    })();
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2024 Seektao | å¯»é“ä¹‹æ—…
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.26.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
